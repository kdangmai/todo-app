name: Deploy Guide

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:

jobs:
  create-release:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Create Release
      if: startsWith(github.ref, 'refs/tags/')
      uses: actions/create-release@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        tag_name: ${{ github.ref }}
        release_name: Release ${{ github.ref }}
        body: |
          ## Deployment Instructions
          
          ### Option 1: Docker (Recommended)
          ```bash
          git clone https://github.com/kdangmai/todo-app.git
          cd todo-app
          git checkout ${{ github.ref_name }}
          docker-compose up -d
          ```
          
          ### Option 2: Manual Installation
          See [README.md](https://github.com/kdangmai/todo-app#installation) for detailed instructions.
          
          ### Environment Setup
          - Frontend: http://localhost:3000
          - Backend: http://localhost:5000
          - Database: localhost:3307
          
          Default credentials: manager/123123az or staff/123123az
        draft: false
        prerelease: false

  build-artifacts:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: 'frontend/package-lock.json'
    
    - name: Build Frontend
      working-directory: ./frontend
      run: |
        npm ci
        npm run build
    
    - name: Create Build Archive
      run: |
        cd frontend/build
        tar -czf ../../frontend-build-${{ github.ref_name }}.tar.gz .
        cd ../..
    
    - name: Upload Build Artifact
      if: startsWith(github.ref, 'refs/tags/')
      uses: actions/upload-artifact@v4
      with:
        name: builds
        path: frontend-build-${{ github.ref_name }}.tar.gz
